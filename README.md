# SNU X Samsung Research Experiment Flutter App

**사용자 상호작용 연구를 위한 챗봇 인터페이스 실험 앱**

## 📱 프로젝트 개요

이 앱은 서울대학교와 Samsung Research에서 사용자의 챗봇 인터페이스와의 상호작용 패턴, 특히 응답 대기 시간에 대한 최대 허용 시간을 측정하기 위한 실험 도구입니다.

### 주요 기능
- 📊 **32개 질문 진행**: 피험자별 개별 맞춤 질문
- ⏱️ **정밀 시간 측정**: 질문 전송부터 응답 중단까지의 대기 시간 측정 (밀리초 단위)
- ⏸️ **중간 휴식**: 16번째 트라이얼 후 10분 휴식 (데모용 10초)
- 🚫 **중복 실행 방지**: 피험자 중복 검사 및 안정적인 상태 관리로 데이터 무결성 보장
- 🔧 **동시성 제어**: 여러 디바이스 동시 사용 시 데이터 충돌 방지

## 🏗️ 시스템 아키텍처

### 화면 구성
```
PermissionScreen (피험자 번호 입력)
       ↓
ChatbotScreen (실험 진행)
  ├── initial (시작 대기)
  ├── loading (점 애니메이션)
  ├── chatting (대화 진행)
  ├── resting (중간 휴식)
  └── finished (완료/다음)
```

### 실험 플로우
```
피험자 번호 입력 (1-80) → 유효성 검사 → 중복 확인 →
전체 질문 로드 → 캐시 저장 →
트라이얼 1-16 → 10분 휴식 → 트라이얼 17-32 →
결과 고정 위치 저장 → 실험 완료
```

## 🛠️ 기술 스택

- **Framework**: Flutter 3.4.4+
- **Language**: Dart
- **Backend**: Google Sheets API
- **Authentication**: Google Service Account
- **State Management**: Flutter StatefulWidget
- **Network**: HTTP/REST API calls

### 주요 의존성
```yaml
dependencies:
  flutter: sdk: flutter
  cupertino_icons: ^1.0.6
  http: ^1.1.0
  gsheets: ^0.5.0
```

## 📋 Google Sheets 연동

### 데이터 구조

#### Query Sheet (질문 데이터)
총 64개 질문 유형, 각 유형마다 4개 질문 (총 256개 질문)

| 질문번호 | 질문내용 |
|---------|---------|
| 1-1 | 첫 번째 질문 유형의 첫 번째 질문 |
| 1-2 | 첫 번째 질문 유형의 두 번째 질문 |
| 1-3 | 첫 번째 질문 유형의 세 번째 질문 |
| 1-4 | 첫 번째 질문 유형의 네 번째 질문 |
| ... | ... |
| 64-4 | 64번째 질문 유형의 네 번째 질문 |

#### Randomization Sheet (피험자별 질문 할당)
80명 피험자가 256개 질문 중 32개씩 evenly randomized로 할당받음
(각 질문당 평균 10명의 피험자가 응답)

| 피험자ID | Q1 | Q2 | ... | Q32 |
|---------|----|----|-----|-----|
| P001 | 18-4 | 12-2 | ... | 45-1 |
| P002 | 03-1 | 61-3 | ... | 22-4 |
| ... | ... | ... | ... | ... |
| P080 | 44-2 | 07-1 | ... | 33-3 |

#### Results Sheet (실험 결과)
| 피험자번호 | 타임스탬프 | 질의번호 | 발송시간 | 중지시간 | Latency (ms) |
|---------|-----------|---------|----------|----------|-----------|
| P001 | 2024-01-01T10:00:00 | 18-4 | 10:00:01 | 10:00:15 | 14000 |

**저장 위치**: 피험자별 고정 위치 (피험자 N → (N-1)*32+2 ~ (N-1)*32+33 행)

## ⚙️ 설치 및 설정

### 1. 프로젝트 클론
```bash
git clone https://github.com/baekdusan/snu-sr-exp1.git
cd snu-sr-exp1
```

### 2. 의존성 설치
```bash
flutter pub get
```

### 3. Google Sheets API 설정
1. Google Cloud Console에서 프로젝트 생성
2. Google Sheets API 활성화
3. 서비스 계정 생성 및 JSON 키 다운로드
4. `lib/services/sheets_service.dart`에 인증 정보 입력
5. Google Sheets에 서비스 계정 이메일 편집자 권한 부여

### 4. 앱 실행
```bash
flutter run
```

## 🔧 사용 방법

### 실험 진행 단계
1. **피험자 번호 입력**: 1-80 범위의 숫자 입력
2. **중복 검사**: 이미 실험 완료된 번호인지 자동 확인
3. **시작 버튼 클릭**: 첫 번째 질문 시작
4. **32개 질문 진행**: 화살표 버튼으로 전송 → 대기 → 정지 버튼으로 중단
5. **중간 휴식**: 16번째 질문 후 10분 휴식 (데모용 10초)
6. **자동 저장**: 모든 질문 완료 시 Google Sheets에 결과 저장
7. **실험 종료**: 초기 화면으로 자동 이동

### 버튼 기능
- **다시 하기**: 현재 질문 재시도
- **다음 질의**: 다음 질문으로 진행 (1-31번 질문)
- **실험 종료**: 모든 결과 저장 후 초기화면 이동 (32번째 질문)

## 🎯 실험 설계 특징

### 질문 분배 방식
- **64개 질문 유형**: 총 256개 질문 풀 (64 × 4)
- **Evenly Randomized 분배**: 각 질문당 평균 10명의 피험자가 응답
- **개별 맞춤**: 각 피험자는 고유한 32개 질문 조합 받음
- **균등 분산**: 모든 질문이 고르게 테스트됨

### 측정 지표
- **반응 시간**: 질문 전송 ~ 응답 중단 시간 (밀리초) - 32개 질문
- **사용자 행동**: 재시도 패턴, 질문별 대기시간 차이, 휴식 후 집중도 변화

### 데이터 수집 방식
- **효율적 구조**: 피험자당 32행의 개별 결과 저장
- **실시간 측정**: 각 질문별 개별 시간 측정 및 메모리 저장
- **일괄 업로드**: 실험 종료 시 모든 결과 Google Sheets에 저장
- **네트워크 안정성**: 저장 실패 시 재시도 메커니즘 제공

## 🚀 성능 최적화

### 데이터 로딩 최적화
- **캐싱 시스템**: 앱 시작 시 전체 질문 데이터(256개 질문)를 메모리에 로드
- **즉시 응답**: 피험자 번호 입력 후 캐시에서 바로 32개 질문 검색
- **네트워크 최소화**: 초기 1회 로드 + 중복 확인 + 결과 저장 시에만 API 호출
- **고정 위치 저장**: 피험자별 전용 행 할당으로 데이터 충돌 방지

### UI/UX 개선사항
- **다양한 화면 상태**: 6가지 상태(initial, loading, chatting, quiz, resting, finished)로 명확한 UX
- **휴식 타이머**: 10분(데모용 10초) 카운트다운으로 휴식 시간 시각화
- **자동 줄바꿈**: 긴 질문도 읽기 편하게 여러 줄 표시
- **로딩 인디케이터**: 저장 중 상태 및 모든 비동기 작업 시각적 피드백
- **에러 처리**: 네트워크 오류 시 재시도 옵션 제공

## 🛡️ 보안 및 안정성

### 데이터 보호
- Google Service Account 기반 안전한 API 인증
- 클라이언트-서버 간 HTTPS 암호화 통신
- 피험자 개인정보 최소 수집 (번호만 사용)

### 오류 처리
- 네트워크 연결 오류 시 재시도 메커니즘
- 잘못된 피험자 번호 입력 시 유효성 검사
- 중복된 피험자 번호 사용 방지
- 동시성 문제로 인한 데이터 충돌 방지
- 예외 상황 로깅 및 사용자 친화적 오류 메시지

## 📊 실험 결과 분석

수집된 데이터는 다음과 같은 분석에 활용 가능:
- **질문 유형별 분석**: 64개 질문 유형별 평균 대기 시간 비교
- **질문 난이도 분석**: 같은 유형 내 4개 질문 간 반응 시간 차이
- **피험자 그룹별 패턴**: 인내심, 재시도 행동 상관관계
- **실험 순서 효과**: 질문 진행에 따른 행동 변화 (학습 효과 등)
- **휴식 효과**: 중간 휴식 전후 반응 시간 변화

## 🏗️ 핵심 파일 구조

```
lib/
├── main.dart                    # 앱 진입점 및 라우팅
├── models/
│   └── question_result.dart     # 실험 결과 데이터 모델
├── screens/
│   ├── permission_screen.dart   # 피험자 번호 입력 화면
│   └── chatbot_screen.dart      # 메인 실험 인터페이스
├── services/
│   └── sheets_service.dart      # Google Sheets API 연동
└── widgets/
    └── app_header.dart          # 공통 헤더 컴포넌트
```

## 📈 구현된 요구사항

✅ 80명 피험자별 개별 질문 관리
✅ 256개 질문 풀에서 32개씩 evenly randomized 분배
✅ 정밀한 반응시간 측정 시스템
✅ 안정적인 Google Sheets 연동
✅ 직관적인 실험 인터페이스
✅ 에러 상황 대응 메커니즘
✅ 멀티 디바이스 동시 사용 지원
✅ 피험자 중복 실험 방지 시스템
✅ 동시성 문제 해결된 데이터 저장

## 📊 성능 지표

- **초기 로딩**: ~3초 (전체 질문 캐시 완료)
- **질문 전환**: <100ms (캐시 기반 즉시 응답)
- **결과 저장**: ~2초 (네트워크 상태에 따라)
- **메모리 사용**: <50MB (256개 질문 캐시 포함)

---

**개발**: Claude Code Assistant
**연구 목적**: SNU X Samsung Research 사용자 상호작용 패턴 분석
**버전**: 1.0.1
**최종 업데이트**: 2025-09-28